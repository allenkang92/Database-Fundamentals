# SQL 응용 연산자 및 함수

## 1. 다중 행 연산자

### 1.1 다중 행 연산자의 개념
- 서브 쿼리의 결과가 여러 개의 튜플을 반환하는 다중 행 서브쿼리에서 사용
- 단일 행 비교 연산자(<, >, =, <>)와 결합하여 사용 가능

### 1.2 다중 행 연산자의 종류

#### 1.2.1 IN
- 리턴되는 값 중에서 조건에 해당하는 값이 있으면 참
- 가장 많이 사용되는 다중 행 연산자

```sql
SELECT * FROM 학생
WHERE 학과 IN (SELECT 학과 FROM 학과 WHERE 단과대학 = '공과대학');
```

#### 1.2.2 ANY, SOME
- 서브쿼리에 의해 리턴되는 각각의 값과 조건을 비교
- 하나 이상을 만족하면 참
- ANY와 SOME은 동일한 기능

```sql
SELECT * FROM 학생
WHERE 평점 > ANY (SELECT 평점 FROM 학생 WHERE 학과 = '컴퓨터공학');
```

#### 1.2.3 ALL
- 값을 서브쿼리에 의해 리턴되는 모든 값과 비교
- 모든 값을 만족해야만 참

```sql
SELECT * FROM 학생
WHERE 평점 > ALL (SELECT 평점 FROM 학생 WHERE 학과 = '컴퓨터공학');
```

#### 1.2.4 EXISTS
- 메인 쿼리의 비교 조건이 서브쿼리의 결과 중에서 만족하는 값이 하나라도 존재하면 참
- 상관 서브쿼리에서 자주 사용

```sql
SELECT * FROM 학생
WHERE EXISTS (SELECT * FROM 수강 WHERE 수강.학번 = 학생.학번);
```

## 2. 집계 함수

### 2.1 집계 함수의 개념
- 여러 행 또는 테이블 전체 행으로부터 하나의 결과값을 반환하는 함수
- GROUP BY 절과 함께 사용하여 그룹별 집계 가능

### 2.2 집계 함수 구문
```sql
SELECT 컬럼1, 컬럼2, ..., 집계함수
FROM 테이블명
[WHERE 조건]
[GROUP BY 컬럼1, 컬럼2, ...]
[HAVING 조건식(집계함수 포함)];
```

### 2.3 집계 함수의 종류

#### 2.3.1 COUNT
- 복수 행의 줄 수를 반환
- NULL 값은 제외하고 계산
```sql
SELECT COUNT(*) FROM 학생;  -- 전체 학생 수
SELECT COUNT(학과) FROM 학생;  -- NULL이 아닌 학과 수
```

#### 2.3.2 SUM
- 복수 행의 해당 컬럼 간의 합계를 계산
- 숫자형 데이터에만 사용 가능
```sql
SELECT SUM(평점) FROM 학생;  -- 전체 학생의 평점 합계
```

#### 2.3.3 AVG
- 복수 행의 해당 컬럼 간의 평균을 계산
- NULL 값은 제외하고 계산
```sql
SELECT AVG(평점) FROM 학생;  -- 전체 학생의 평균 평점
```

#### 2.3.4 MAX/MIN
- MAX: 복수 행의 해당 컬럼 중 최댓값을 계산
- MIN: 복수 행의 해당 컬럼 중 최솟값을 계산
- 숫자, 문자, 날짜 형식 모두 사용 가능
```sql
SELECT MAX(평점), MIN(평점) FROM 학생;  -- 최고 평점과 최저 평점
```

#### 2.3.5 통계 함수
- STDDEV: 복수 행의 해당 컬럼 간의 표준편차를 계산
- VARIANCE: 복수 행의 해당 컬럼 간의 분산을 계산
```sql
SELECT STDDEV(평점), VARIANCE(평점) FROM 학생;  -- 평점의 표준편차와 분산
```

## 3. GROUP BY 및 HAVING

### 3.1 GROUP BY 절
- 데이터를 그룹화하여 집계 함수를 적용할 때 사용
- NULL 값을 가지는 행도 하나의 그룹으로 처리
- SELECT 절에서 사용한 별칭(ALIAS) 사용 불가
- WHERE 절보다 나중에 실행됨

#### 3.1.1 특징
- 그룹화할 열을 지정
- 여러 열을 기준으로 그룹화 가능
- 그룹화된 열 또는 집계 함수만 SELECT 절에서 사용 가능

#### 3.1.2 예시
```sql
-- 학과별 학생 수와 평균 평점
SELECT 학과, COUNT(*) as 학생수, AVG(평점) as 평균평점
FROM 학생
GROUP BY 학과;
```

### 3.2 HAVING 절
- GROUP BY로 그룹화된 결과에 조건을 적용할 때 사용
- 집계 함수를 조건으로 사용 가능
- WHERE 절과 달리 그룹화된 결과에 대한 조건을 지정

#### 3.2.1 특징
- 그룹 함수를 이용한 조건 지정 가능
- GROUP BY 절 뒤에 위치
- 그룹화된 데이터의 필터링에 사용

#### 3.2.2 예시
```sql
-- 평균 평점이 3.0 이상인 학과만 조회
SELECT 학과, AVG(평점) as 평균평점
FROM 학생
GROUP BY 학과
HAVING AVG(평점) >= 3.0;