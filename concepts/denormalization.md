반정규화(Denormalization)

반정규화

반정규화의 개념

정규화를 통하면 정합성과 데이터 무결성이 보장되지만, 테이블의 개수가 증가함에 따라 테이블 간의 조인이 증가하여 조회 성능이 떨어질 수 있다. 이렇게 정규화된 엔터티, 속성, 관계에 대해 시스템의 성능 향상과 개발 및 운영의 단순화를 위해 중복, 통합, 분리 등을 수행하는 모델링의 기법을 의미한다.

반정규화 기법 : 테이블 반정규화, 컬럼 반정규화, 관계 반정규화

반정규화 사용 시기

정규화에 충실하였으나 수행 속도에 문제가 있는 경우

다량의 범위를 자주 처리해야 하는 경우

특정 범위의 데이터만 자주 처리하는 경우

처리 범위를 줄이지 않고는 수행 속도를 개선할 수 없는 경우

요약 자료만 주로 요구되는 경우

반정규화 절차

반정규화 대상 조사

범위 처리 빈도수 조사

대량의 범위처리 조사

통계성 프로세스 조사

테이블 조인 개수

다른 방법 유도 검토

뷰 테이블

클러스터링 적용

인덱스의 조정

응용 애플리케이션

반정규화 적용

테이블 반정규화

속성 반정규화

관계 반정규화

반정규화 기법

테이블 반정규화

테이블 병합

일대일 관계

두 테이블의 레코드를 결합하여 하나의 테이블로 만든다

효과: 데이터 중복 제거, 성능 향상

일대다 관계

일대다의 관계를 맺는 두 테이블을 결합할 대, 보통 일대다 관계에서 ‘일’인 테이블에 속한 레코드를 중심으로 다른 테이블과 조인하여 새로운 테이블을 만든다

효과: 성능 향상

다대다 관계

일반적으로 링크 테이블을 생성하여 두 개의 다른 테이블을 중심으로 데이터를 결합한다

효과: 성능 향상

테이블 분할

수직 분할 

열을 기준으로 테이블을 분할하는 방법

테이블의 칼럼 중 자주 사용하는 컬럼과 그렇지 않은 컬럼으로 분리하여, 자주 사용하는 컬럼이 포함된 테이블과 그렇지 않은 컬럼이 포함된 테이블로 분할한다.

자주 사용하는 데이터에 대한 접근 시간을 단축한다.

수평 분할

행을 기준으로 테이블을 분할하는 방법이다

테이블의 행을 분할하여, 분할된 테이블들을 병렬 처리하여 성능 향상을 도모한다.

분할 기준은 범위나 해싱 기반으로 이루어진다.

테이블 추가

중복 테이블 추가

업무가 다르거나 서버가 분리되었을 대 같은 테이블을 중복으로 추가하여 원격 조인을 제거하는 방법을 통하여 성능을 향상시킨다

집계 테이블 추가

합계, 평균 등 통계 계산ㅇ르 미리 수행하여 계산해 두어 조회 시 성능을 향상한다

이력 테이블 추가

이력 테이블에 레코드를 중복으로 저장하여 성능을 향상시킨다

부분 테이블 추가

하나의 테이블의 전체 컬럼 중 자주 이용하는 집중화된 컬럼이 있으면, 디스크 I/O를 줄이기 위해 해당 컬럼들을 모아놓은 별도의 반정규화된 테이블을 생성한다.

진행 테이블 추가

검색 조건이 여러 테이블에 걸쳐 다양하게 사용되어 복잡하고 처리량이 많은 경우 사용한다.

컬럼 반정규화

중복 컬럼 추가

조인 시 성능 저하를 예방하기 위해, 중복된 컬럼을 추가하여 조인 횟수를 감소시킨다.

파생 컬럼 추가

트랜잭션이 처리되는 시점에 계산 때문에 발생하는 성능 저하를 예방하기 위해 미리 계산된 값을 저장하는 파생 컬럼을 추가한다.

이력 테이블 컬럼 추가

대량의 이력 데이터를 처리할 대 임의의 날짜 조회나 최근 값을 조회할 때 발생하는 성능 저하를 예방하기 위해 최근값 여부, 시작일, 종료일 등의 기능성 컬럼을 추가한다.

PK에 의한 컬럼 추가

복합 의미가 있는 기본키를 단일 속성으로 구성했을 때 성능 저하가 발생한 경우 PK 안에 데이터가 존재하지만, 성능 향상을 위해 일반 컬럼으로 추가한다.

응용 시스템 오작동을 위한 컬럼 추가

업무적으로는 의미가 없으나, 데이터 처리할 때 오류로 안해 원래값으로 복구하길 원하는 경우 이전 데이터를 임시로 중복으로 보관하는 컬럼을 추가한다.

관계 반정규화

중복 관계 추가

데이터 처리 시 여러 경로를 거쳐 조인할 수 있지만, 이때 발생할 수 있는 성능 저하를 방지하기 위해 추가적인 관계 설정을 통하여 성능을 향상시킬 수 있다.

데이터베이스 분할(파티셔닝)

데이터베이스 분할의 목적

데이터가 비대해지면서 조회하는 시간이 길어질 때 또는 관리 용이성, 성능, 가용성 등의 향상을 위해 테이블을 여러 부분으로 분할하는 것을 의미한다.

가장 일반적인 형태는 분산 데이터베이스 분할로, 각 파티션은 여러 노드로 분산 배치되어 사용자가 각 노드에서 로컬 트랜잭션을 수행할 수 있도록 하는 기법

파티션 각각이 작은 데이터베이스가 되도록 분할하는 방법과 하나의 테이블만 같이 선택된 요소로 분리하는 방법이 있다.

데이터베이스 분할의 장점

전체 데이터를 손실할 가능성이 줄어들어 데이터 가용성이 향상된다.

파티션별로 백업 및 복구를 할 수 있다.

파티션 단위로 I/O 분산이 가능하여 갱신 성능을 향상시킨다.

데이터 전체 검색 시 필요한 부분만 탐색해 성능이 증가한다.

필요한 데이터만 빠르게 조회할 수 있어서 쿼리 자체가 가볍다

관리적 측면 : 파티션 단위 백업, 추가, 삭제, 변경

성능적 측면 : 파티션 단위 조회 및 DML 수행

단점

테이블 간 조인에 대한 비용이 증가한다

테이블과 인덱스를 별도로 파티셔닝 할 수 없다

테이블과 인덱스를 같이 파티셔닝 해야 한다.

분할 키 기준 분할 유형

범위 분할

지정한 값을 기준으로 행을 일정 범위로 분할하여 파티션에 할당하는 방법

연속적인 값을 기준으로 분할하는 방법

목록 분할

값 목록에 파티션의 할당 분할 키값을 그 목록에 비추어 파티션을 선택한다

이산적인 값을 기준으로 분할 하는 방법

해시 분할

해시 함수의 값에 따라 파티션에 포함할지를 결정한다

해시 함수를 사용하여 분할하는 방법

합성 분할

범위, 목록, 해시 분할을 결합하여 사용한다

조합 분할

두 가지 이상의 분할 방법을 결합하여 사용하는 방법

라운드로빈 분할

파티션에 행의 고른 분포를 원할 때 사용한다.

기본키가 필수가 아니며, 해시 분할과 다르게 분할 컬럼을 명시하지 않아도 된다.

라운드로빈 방식으로 데이터를 분배하면서 새로운 행이 파티션에 할당된다.

데이터베이스 클러스터링

데이터베이스 클러스터링의 개념

두 대 이상의 서버를 하나의 서버처럼 운영하는 기술로, 서버 이중화 및 공유 스토리지를 사용하여 서버의 가용성을 높이는 기술

병렬 처리 클러스터링

처리율을 높이기 위한 목적으로 단위 작업을 여러 서버에서 분산 처리한다.

고가용성 클러스터링

하나의 서버에게 장애가 생기면 다른 서버가 작업을 이어받아 처리하여 서비스 중단을 방지한다

Active-Active 방식과 Active-Stand By 방식이 있다.

클러스터링의 단점

여러 대의 서버가 데이터베이스를 공유하므로 병목 현상이 발생해 더 큰 비용이 발생할 수 있다.

Active-Active 방식은 모든 서버가 활성화된 상태이므로 병목 현상이 더 심하게 발생할 수 있다.

Active-Stand By 방식은 하나의 서버만 활성화하고 다른 하나는 유휴상태로 대기하는 방식. 구현이 쉽고 비용이 적게 들며 병목 현상이 적게 발생하지만 가용성이 떨어지고 서버 장애 발생 시 Stand By 서버가 가동하는 데 시간이 필요하다.