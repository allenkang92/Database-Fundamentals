# PostgreSQL 아키텍처

## 1. 시스템 아키텍처 개요

### 1.1 클라이언트/서버 모델
- 서버 프로세스 (postgres)
  - 데이터베이스 파일 관리
  - 클라이언트 연결 허용
  - 데이터베이스 작업 수행
- 클라이언트 애플리케이션
  - 텍스트 기반 도구
  - 그래픽 애플리케이션
  - 웹 서버
  - 데이터베이스 관리 도구

### 1.2 네트워크 통신
- TCP/IP 기반 통신
- 다중 호스트 지원
- 파일 시스템 접근 차이 고려

## 2. 프로세스 구조

### 2.1 메인 프로세스
- postmaster (관리용 서버 프로세스)
- 클라이언트 연결 대기
- 새로운 서버 프로세스 생성

### 2.2 백엔드 프로세스
- 클라이언트당 독립적 프로세스
- 프로세스 격리
- 자원 관리

## 3. 메모리 아키텍처

### 3.1 공유 메모리
- 공유 버퍼 풀
- 캐시 관리
- 시스템 카탈로그

### 3.2 로컬 메모리
- 프로세스별 작업 메모리
- 정렬 작업 영역
- 임시 버퍼

## 4. 저장소 아키텍처

### 4.1 물리적 저장소
- 데이터 파일
- WAL (Write-Ahead Log)
- 설정 파일
- 제어 파일

### 4.2 논리적 구조
- 데이터베이스
- 테이블스페이스
- 스키마

## 5. 프로세스 관리

### 5.1 연결 관리
- 최대 연결 수 제한
- 연결 풀링
- 부하 분산

### 5.2 백그라운드 프로세스
- 자동 vacuum
- 체크포인터
- WAL 작성기
- 통계 수집기

## 6. 버퍼 관리

### 6.1 버퍼 풀
- 공유 버퍼 관리
- 버퍼 교체 정책
- 버퍼 핀닝

### 6.2 캐시 관리
- 버퍼 캐시
- 카탈로그 캐시
- 플랜 캐시

## 7. 보안 아키텍처

### 7.1 인증 시스템
- 클라이언트 인증
- 역할 기반 접근 제어
- SSL 지원

### 7.2 권한 관리
- 객체 권한
- 스키마 권한
- 시스템 권한

Creating a Database 
## 데이터베이스 생성

데이터베이스 서버에 접근할 수 있는지 확인하는 첫 번째 테스트는 데이터베이스를 생성해보는 것입니다. 실행 중인 PostgreSQL 서버는 여러 데이터베이스를 관리할 수 있습니다. 일반적으로 각 프로젝트나 사용자마다 별도의 데이터베이스를 사용합니다.

아마도 사이트 관리자 분께서 이미 사용할 데이터베이스를 생성해 두셨을 것입니다. 그런 경우 이 단계를 생략하고 다음 섹션으로 넘어갈 수 있습니다.

새로운 데이터베이스를 생성하려면, 이 예제에서는 `mydb`라는 이름으로, 다음 명령을 사용합니다:

```shell
$ createdb mydb
응답이 없으면 이 단계가 성공적으로 완료된 것이므로 이 섹션의 나머지 부분은 건너뛰어도 됩니다.

다음과 같은 메시지가 나타난다면:
createdb: command not found

PostgreSQL이 제대로 설치되지 않은 것입니다. 설치되지 않았거나, 쉘의 검색 경로에 포함되지 않았을 수 있습니다. 대신 절대 경로를 사용하여 명령을 호출해 보십시오:
$ /usr/local/pgsql/bin/createdb mydb

이트의 경로는 다를 수 있습니다. 상황을 해결하려면 사이트 관리자에게 문의하거나 설치 지침을 확인하십시오.

또 다른 응답은 다음과 같을 수 있습니다:

이는 서버가 시작되지 않았거나 createdb가 기대하는 곳에서 수신하고 있지 않다는 의미입니다. 다시 한번 설치 지침을 확인하거나 관리자에게 문의하십시오.

또 다른 응답은 다음과 같습니다:
createdb: error: connection to server on socket "/tmp/.s.PGSQL.5432" failed: FATAL:  role "joe" does not exist
여기서 자신의 로그인 이름이 언급됩니다. 이는 관리자가 PostgreSQL 사용자 계정을 생성하지 않았을 때 발생합니다. (PostgreSQL 사용자 계정은 운영 체제 사용자 계정과는 별개입니다.) 관리자인 경우, 계정 생성에 대한 도움을 받으려면 21장을 참조하십시오. 첫 번째 사용자 계정을 생성하려면 보통 postgres로 설치된 운영 체제 사용자로 전환해야 합니다. 또는 운영 체제 사용자 이름과 다른 PostgreSQL 사용자 이름이 할당된 경우, -U 옵션을 사용하거나 PGUSER 환경 변수를 설정하여 PostgreSQL 사용자 이름을 지정해야 합니다.

사용자 계정이 있지만 데이터베이스를 생성할 권한이 없는 경우, 다음과 같은 메시지가 표시됩니다:

database
모든 사용자가 새로운 데이터베이스를 생성할 수 있는 권한을 가진 것은 아닙니다. PostgreSQL이 데이터베이스 생성 요청을 거부하는 경우, 사이트 관리자가 데이터베이스 생성 권한을 부여해야 합니다. 이 경우 사이트 관리자에게 문의하십시오. PostgreSQL을 직접 설치한 경우, 이 튜토리얼의 목적으로 서버를 시작한 사용자 계정으로 로그인해야 합니다.[1]

또한 다른 이름으로도 데이터베이스를 생성할 수 있습니다. PostgreSQL은 주어진 사이트에서 여러 데이터베이스를 생성할 수 있도록 허용합니다. 데이터베이스 이름은 알파벳 문자로 시작해야 하며, 길이는 63바이트로 제한됩니다. 편리한 선택은 현재 사용자 이름과 동일한 이름의 데이터베이스를 생성하는 것입니다. 많은 도구들이 데이터베이스 이름을 기본값으로 가정하기 때문에 입력을 줄일 수 있습니다. 해당 데이터베이스를 생성하려면 다음과 같이 입력하십시오:

$ createdb

더 이상 데이터베이스를 사용하지 않으려면 제거할 수 있습니다. 예를 들어, mydb 데이터베이스의 소유자(생성자)인 경우, 다음 명령을 사용하여 파괴할 수 있습니다:

$ dropdb mydb

(이 명령에서는 데이터베이스 이름이 사용자 계정 이름으로 기본 설정되지 않습니다. 항상 이름을 지정해야 합니다.) 이 작업은 데이터베이스와 관련된 모든 파일을 물리적으로 제거하며 되돌릴 수 없으므로, 신중하게 수행해야 합니다.

createdb와 dropdb에 대한 자세한 내용은 각각의 명령어 문서에서 확인할 수 있습니다.

[1] 이 작업이 가능한 이유는 PostgreSQL 사용자 이름이 운영 체제 사용자 계정과 별개이기 때문입니다. 데이터베이스에 연결할 때, 연결할 PostgreSQL 사용자 이름을 선택할 수 있습니다; 그렇지 않으면 현재 운영 체제 계정과 동일한 이름으로 기본 설정됩니다. 사실, PostgreSQL 서버를 시작한 운영 체제 사용자와 동일한 이름을 가진 PostgreSQL 사용자 계정은 항상 존재하며, 이 사용자 계정은 데이터베이스를 생성할 수 있는 권한을 가지고 있습니다. 해당 사용자로 로그인하는 대신, 어디서든 -U 옵션을 사용하여 연결할 PostgreSQL 사용자 이름을 선택할 수 있습니다.